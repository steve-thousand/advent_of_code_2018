input = """wlpiogsvdfecjdqmnxakudrhbz
wbpioesvyfecjuqmlxaktdrhbz
blviogavyfecjuqmnxaktdrhbz
wlpiogsvydecjuqmnipktdrhbz
wlwiogsvyfmcjuqmoxaktdrhbz
wlpiogsvphecjuqmnxaktdrzbz
wlpiogsvyfecjuqmnkakhdrkbz
wlpiogsvyfhcjuqmnxxktddhbz
wlpiogsvyfccfuqmnxgktdrhbz
wlpiogsvhmecjvqmnxaktdrhbz
wlpiogsvyfecjdqqnxaktdrhyz
wlpiogyvycecjaqmnxaktdrhbz
wlpiogsvyfecjfqmnxaktybhbz
wkpiogsvyfmcauqmnxaktdrhbz
wlmiolsvyfecjuqmnxaktdrhbn
wlpioksvyfecjuqmnxaktdrhgs
wlpiogsvyflcjuvmnxsktdrhbz
wgziogsvyfecjuqmnxaktdrhoz
whpingsvyeecjuqmnxaktdrhbz
wlpiogsvyfecjuqgnxaktdvhlz
wlpioasvtfecjuqmnxaktdahbz
wlpihgsvefeceuqmnxaktdrhbz
wlpiogsvyfecyuqwnxaktdghbz
wlpfsgsvyfhcjuqmnxaktdrhbz
wlpiogyvyfecjuqmnxalpdrhbz
wlpiogsvyfescsqmnxaktdrhbz
wluiogsvyfecytqmnxaktdrhbz
wltiorsvyfecjuqmoxaktdrhbz
wlmiogwvyfejjuqmnxaktdrhbz
wlpiogsvyfycjuumnxvktdrhbz
wlkiogsqyfecjqqmnxaktdrhbz
wlpiogsvyfecouqmnxaktfrubz
hupiogsvlfecjuqmnxaktdrhbz
wlpiogsvpxecjuqmnxaksdrhbz
wlpiogsvyfkcjfqmnxxktdrhbz
wlpiogsjyfecjuqnnxakthrhbz
wlpiogsvyfecjuqmnxaktddhdk
wlpipgsvyfecjuqmnhaktdrubz
wlpiogsoyfenjpqmnxaktdrhbz
wlpiogsvyfecnuqmnxaxtdrmbz
wlpiggsvyfjcjuumnxaktdrhbz
wlppogsvyfecjuqmnxautdhhbz
wlpiovbvyfecjuqmnxaktcrhbz
wlpiogsvyfecjoqmnxaktdrobu
wlpiohsvyfecjugmnxakthrhbz
wvpiogovyfecjuqmnxakwdrhbz
wlpiogsbyfecjuqmnxdktdrtbz
wlpnogsvyfecjuqmnxakykrhbz
wlpiogpvyfecjuqmnxvktdrhbs
wlpiogsvkvecjuqmnxadtdrhbz
wlkihgsvyfecjuqmnxlktdrhbz
wlpilgsvyfhcjuqmnxakudrhbz
wlpioksvysgcjuqmnxaktdrhbz
wlpiogsvyfecorqmoxaktdrhbz
wlpiogsvyfectzlmnxaktdrhbz
wlpiogsvywecjuqwnqaktdrhbz
wlpiowsvyfecjuqrnxaftdrhbz
wlpiogsuyfecjutmnxaktnrhbz
wepiowsvyfqcjuqmnxaktdrhbz
wlpirgssyfecjuqmvxaktdrhbz
wlyiogstyfecjuqmnxaktdrhbw
wlpiogseyfecauqmnxaktdjhbz
wlpioisvyfenjuqmnxakrdrhbz
wlpiogsvyfrgjfqmnxaktdrhbz
wlpionsvyfecjmqmjxaktdrhbz
alpiggsvyfecjuqmnxaktdrhkz
wlphngsvyfecjuqmnxfktdrhbz
wlpiogsvyferjuqmlxakttrhbz
wlniogsvefecjuqsnxaktdrhbz
wlpiogsvyfncjurmnxakudrhbz
wlpiogsvyfecjuqmnxaktprlaz
wlpiocsvyfecjupmkxaktdrhbz
wlpihgsvyfecjeqfnxaktdrhbz
wlwioasvyfjcjuqmnxaktdrhbz
wlpifgsvyfecjuqsnxaktdshbz
wlxiogsvyrechuqmnxaktdrhbz
wlpiogovyfxcjuqmnxakkdrhbz
wlpiogsvyfecjkqmdxaktmrhbz
wlpiogsvyfecjwqmntaktdhhbz
wlpiogsvdfecjuqmmxaktbrhbz
wlpiogsvyfecauqmnxaksdrhwz
wlpiogsvwfecjuqznxaktorhbz
wlpiogtvyfecjuqhnxakidrhbz
wlpiogsvyyecjuqmnxaktdrhwt
wljiogsvyfecfuqbnxaktdrhbz
wlpiogsvybecjuqmnxagtdrjbz
wrpiogsvyfecjuqmnuaktdrhbd
wlpiogsvyfecjurmnxnltdrhbz
blpvogsvyaecjuqmnxaktdrhbz
bfpiogyvyfecjuqmnxaktdrhbz
wlpiogsvyfecjuqinxaknddhbz
wlpizgsvvfecjuqxnxaktdrhbz
glpiogsvyrecjuqmnxaktdrhbr
wlpiogskhfecjutmnxaktdrhbz
wlpiogsvyfecmuqmnxaktdribc
wlpioesvwfecjuqmnxakkdrhbz
wlpionsrafecjuqmnxaktdrhbz
wlsiogsvyfecjuqmnaaktdrhvz
bloiogsvyfecjuqmnxakjdrhbz
wlpiogsvyfecjuqenmastdrhbz
wlpiogyvyfecjuqmuxakldrhbz
plpiogovyfecjuvmnxaktdrhbz
wlpiogsvyfebjuqmnkakvdrhbz
wlziogsvyfhcjuqmngaktdrhbz
wlsiogsvyfecjuqmnxaktdrzjz
plbiogsvyfecfuqmnxaktdrhbz
wfpiogsvyfecjuqknxaktdrhiz
wlpiogjbyfecjuqmnxaktprhbz
wmpiogsvyrecjcqmnxaktdrhbz
wlpiogsyyfecjuqmqxaktdrbbz
wlpiogsvyfecjuqknxaetdehbz
wlpiogsvyfezjuqmnxakkdhhbz
wlpiogsvyfecjjqvnxaktdrhiz
wkpiogsvyfucjuqmnxaktdrhbd
lliiogsvyfecjuqmnxaktdrhoz
wlpiogsvyfecjuqmsxdktdshbz
wlprogtvyfecjuqmnxaktvrhbz
wlpizgssyffcjuqmnxaktdrhbz
wlpioasvyfvcjuqmnxakldrhbz
wlpoogsvyyecjuqmnxastdrhbz
wlpiognvyfecjuqmnsaktdrhbr
wlpiogsoyfecjuqmnxaktdrhho
wfpiogsvydecjuqmnxaotdrhbz
wlpiogsvqhecjuqmnxaktdrhhz
wkpiogsvyfeojuqmnxaktdrqbz
wlpiogsvyfeveuqmnxaktdshbz
wlpiogbvyfecjuqmexaktdrcbz
wlpxogsvyfehjsqmnxaktdrhbz
wlpcogsvyfecjuqmnjakttrhbz
wlpiogsvvkecjuqmnxaftdrhbz
wlpiogsvffecnuqmnxaktdnhbz
wlpiogsvyfecjupjnxaktdrhbr
wlpqogsvyfecjuqmnxlktdphbz
wlpxogsvyfecjvqmnxaktirhbz
elpiogsvyfecjuqlnxaqtdrhbz
wspiogsvrfecjuqmnxakadrhbz
wlpiogsmyfecbuqmnxactdrhbz
wlpiogsvyfecauqmnyakzdrhbz
wlsiogsvyfecjuqmnxakvdrnbz
wlpiogsxyfeijuqmnxakndrhbz
wlpiogsvyfecjuumnxakbyrhbz
wlpiogsvyfecjuqmnxhktdyhbo
wlpiogsvyfecjuqqnxnjtdrhbz
wapiogsvyfecjuqmnxoktdrmbz
wlpiogsvyfeejvqmnxaktdrubz
wlpitgsvyeectuqmnxaktdrhbz
alpiogsvyfecjulmnxaktdchbz
wlpiogsvyfecjuqmuxoktdrwbz
wlpiogsvyfzgjuhmnxaktdrhbz
wlpnogsvyfecjuqmdxaktyrhbz
wlpiogsvyfecjuqmnxakthrhra
wliiogsvyfecluqmnxaktdhhbz
wlpiogsvyfecjuymnxaltdrhwz
wlpiogsvyfeljuqmnxaktyrhbd
wlpiygsvvfecjuqmfxaktdrhbz
wlpiogihsfecjuqmnxaktdrhbz
wlpiogjvyfecjuqmnhuktdrhbz
wldiogsvyfecjiqmwxaktdrhbz
wlpiogsvjfecjuqmnxaktdrgbr
wlpioisvyfecjuqwnxabtdrhbz
wlviogsvyfscjuqmnxqktdrhbz
wlpiogsvyfecjuqmuxakbdrubz
wlpiogsvyfecjuqmnxmatdrhqz
wlpiogsvyfbcjuqwmxaktdrhbz
wlpiogsvyfexjuqmnxuxtdrhbz
wljiogsvbfecjuqmnxartdrhbz
wlpvogsvyfeujuqmnxaktdmhbz
wnpiogsvyfekjuqanxaktdrhbz
wlprogsvyfecjuqmzxvktdrhbz
wkpiogvvyfecjuqmnxaktdrabz
wlpiogsvwfecjuqmnxaktkbhbz
wlpiogsvyfecjlqmnxtttdrhbz
wlpioqsvyfecjuqznxaktyrhbz
wlpiogsvyfecjuqmnxnethrhbz
wlpiogsyyfgcjuqmnxaktdrhbm
wlpiopsvbfecjuqmnxaktdlhbz
wloqogsvyfucjuqmnxaktdrhbz
wlpiogsvmfecjuqmnxmktdrhtz
wlhiogsvyfecjuhmnxaktsrhbz
wlpioggvpfecjufmnxaktdrhbz
wlpiogsvyfbcjuomnxaktdrhbh
wlpmogsvyfecyuqmnxoktdrhbz
wlpiogslyfecjuqmnxaptyrhbz
tlpiogsnyfecguqmnxaktdrhbz
wlpiogsvyfecjuqmnxwktwehbz
wlpiogsvgfecjuqmnxaktdrabu
wbpiogsvyfecjuqmnxagtdrhoz
wlwipgsvyfecjuqmnxaktdrhbu
wlpwogsvykeczuqmnxaktdrhbz
wlpgogsvwfecjuqmnxcktdrhbz
wlpiogsqyfecjuqmrxaktdrrbz
wlpiogsvyfecjuqmnxakthrafz
wypicgseyfecjuqmnxaktdrhbz
wlpiogcvqfecjuqmnxaktdrhzz
wlriogsvyfecouqmnkaktdrhbz
wlpiogsvyfemjulmnxaktdrhdz
flpiogadyfecjuqmnxaktdrhbz
wupiogsvyfbvjuqmnxaktdrhbz
wlpiogsvyfebjummnxaktdrrbz
wjpiogsvyfecjuqmnxaktprybz
wlpirgsvyfecjiqmnxaatdrhbz
bvpiogsvyfecjuqmnxaktdrhez
wlpiogsvyfxcjuqmnxykzdrhbz
wlkiwgsqyfecjqqmnxaktdrhbz
wepaogsvyfecjxqmnxaktdrhbz
wlpiovsvyfecjjqmnxaktdmhbz
wlpioysryfecjuqmnxaktdrhiz
wlpizjsvyfecjuvmnxaktdrhbz
dlpiogsvyfecjucmnxakbdrhbz
wlpiogsccfecjrqmnxaktdrhbz
wlpioggvyfecpuqmnxagtdrhbz
wlpiogsvyfvcjuumlxaktdrhbz
wwpiogsryfjcjuqmnxaktdrhbz
wlpiogsvyfecjuqynxaktdrogz
wlpiogsvyfecjpqmnxskbdrhbz
wlpiogsvyfecjuhmfxaktvrhbz
wlpiogevyfecjrqmnwaktdrhbz
wlpiigsvyfemjuqmnxaktdrhtz
wlpcogsvyfecjuqhnxakgdrhbz
wupiogsvyfxcjuqmnxaktdrhgz
wlsiogsvyfecjuqenxuktdrhbz
wlpioglvyfecjujmexaktdrhbz
wlriogsvyfeljuqmnxattdrhbz
wlpiogsvyfecfuqmhxaktkrhbz
wlppogsvyfecjuqmxxabtdrhbz
wlniogsvyfevjuqwnxaktdrhbz
wlhiogsvyfecjuqmnxactxrhbz
ilpiogivyflcjuqmnxaktdrhbz
wlpmogsvyfecjuqmnxaktdrlbs
wipiogsvyfeqjuqmnxaktrrhbz
wvpiogsvyfecjuqknxaktdrrbz
wwpioguvyfecxuqmnxaktdrhbz
wlpiogsvkfdcjuqmnxaktdzhbz
wlpiogfvyfecjuqmnxadtdrhbg
wlpiogsvyzefjuqfnxaktdrhbz
wlpiogstyfechuqmnxaktdchbz
wlpiogszyfedjuqmnxsktdrhbz
wzpiozsvyfncjuqmnxaktdrhbz
xlpiogsvyfefjuqmnmaktdrhbz
wlpiogsvyfebxummnxaktdrhbz
wlpiogsgyfecfurmnxaktdrhbz
wlpqogsvyfecjuomnxaktdrhbi
wlpiogjvufecjuqmnxaktdrhbd
wlpiolsvyfecduqmnxaktrrhbz
wlpxogsvyfecjuqmnxaktgrhbk
wlpiogsfyfncjuqmnxsktdrhbz
wlpioggvyfecjufmnxaktdrebz
wlpiogsvyfecfujmnxaktdrwbz
rlpiogsvyfecjlqmnxaktdqhbz
wlpfogsvyfecjuimnxaktfrhbz"""

testInput = """abcdef
bababc
abbcde
abcccd
aabcdd
abcdee
ababab"""

testInput2 = """abcde
fghij
klmno
pqrst
fguij
axcye
wvxyz"""

testInput3 = """abcde
axcye"""

def getLetterCounts(string):
    countsPerLetter = {}
    for i in string:
        if i not in countsPerLetter:
            countsPerLetter[i] = 1
        else:
            countsPerLetter[i] = countsPerLetter[i] + 1
    return countsPerLetter

def getMultiples(countsPerLetter):
    pairs = set()
    trios = set()
    for k, val in countsPerLetter.iteritems():
        if val == 2:
            pairs.add(k)
        elif val == 3:
            trios.add(k)
    return {"pairs": pairs, "trios": trios}

class Node:

    def __init__(self, value):
        self.value = value
        self.children = {}

    def searchMatchOffByMismatchAmount(self, string, mismatches):
        match = [self.value] if self.value is not None else []

        if len(string) == 0:
            # we reached the end
            if mismatches != 0:
                # we reached the end but did not find our exact mismatches, failed
                return False
            else:
                return match

        children = self.children
        firstLetter = string[0]
        if firstLetter in children:
            result = children[firstLetter].searchMatchOffByMismatchAmount(string[1:], mismatches)
            if result is not False:
                match.extend(result)
            else:
                match = False
        else:
            # START HERE
            mismatches -= 1
            if mismatches < 0:
                return False
            else:
                if len(string) == 1:
                    # the final mismatch was the last letter
                    return []
                for child in children.itervalues():
                    innerSearch = child.searchMatchOffByMismatchAmount(string[1:], mismatches)
                    if innerSearch is not False:
                        match.extend(innerSearch[1:])
                        return match
                # if we got here, could not find a match below
                return False
        return match


    def pushString(self, string):
        child = None
        firstLetter = string[0]
        if firstLetter not in self.children:
            child = Node(firstLetter)
            self.children[firstLetter] = child
        else:
            child = self.children[firstLetter]
        restOfString = string[1:]

        if len(restOfString) > 0:
            child.pushString(restOfString)

        return matchedLetters

trieRoot = Node(None)
pairs = 0
trios = 0
matchedLetters = []
for i in input.split("\n"):

    # first search for matching string off by one
    result = trieRoot.searchMatchOffByMismatchAmount(i, 1);

    # then push
    trieRoot.pushString(i)

    if result is not False:
        matchedLetters = result
    multiples = getMultiples(getLetterCounts(i))
    if len(multiples["pairs"]) > 0:
        pairs += 1
    if len(multiples["trios"]) > 0:
        trios += 1

checksum = pairs * trios

print("part 1: " + str(checksum))
print("part 2: " + str(''.join(matchedLetters)))